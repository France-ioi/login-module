<!DOCTYPE html>
<meta charset="utf-8">
<iframe src="login.html?large=1" id="loginIframe" frameBorder="0" style="margin: 10px; height: 400px; width: 400px;"></iframe>
<script type="text/javascript">

function getQuery () {
  var result = {};
  var pairs = window.location.search.substring(1).split('&');
  for (var i = 0; i < pairs.length; i++) {
      var pair = pairs[i].split('=');
      result[decodeURIComponent(pair[0])] = decodeURIComponent(pair[1]);
  }
  return result;
}

var query = getQuery();
var iframeUrl = 'login.html?large=1';
if (query.requiredBadge) {
  iframeUrl += '&requiredBadge='+encodeURIComponent(query.requiredBadge);
}

var loginIframe = document.getElementById('loginIframe');
loginIframe.src = iframeUrl;

(function () {

  window.addEventListener('message', function (e) {
    var message = JSON.parse(e.data);
    if (message.source === 'loginModule' && message.request === 'login') {
      var query = getQuery();
      var content = message.content;
      window.location.href = query.afterLogin + '&jwt=' + content.token;
      return;
    }
  }, false);

}());
</script>